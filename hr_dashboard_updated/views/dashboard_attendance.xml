<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <template id="dashboard_attendance" name="HR Dashboard">
    <t t-call="website.layout">
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

      <style>
        /* Sidebar */
        .dashboard-sidebar {
          position: fixed;
          top: 70px; /* navbar height */
          left: 0;
          height: 100%;
          width: 240px;
          background: #f8f9fa;
          border-right: 1px solid #dee2e6;
          box-shadow: 0 2px 8px rgba(0,0,0,0.08);
          z-index: 1000;
          padding-top: 15px;
        }
        .dashboard-sidebar .list-group-item {
          border: none;
          border-radius: 0;
          padding: 14px 18px;
          font-weight: 500;
          color: #495057;
          transition: all 0.3s ease;
        }
        .dashboard-sidebar .list-group-item:hover {
          background-color: #e9ecef;
        }
        .dashboard-sidebar .list-group-item.active {
          background: linear-gradient(45deg, #0d6efd, #4dabf7);
          color: #fff;
          font-weight: 600;
        }

        /* Content */
        .dashboard-content {
          margin-left: 260px;
          padding: 30px 20px;
        }

        /* Cards */
        .summary-card {
          border-radius: 20px;
          color: #fff;
          padding: 20px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.08);
          transition: transform 0.2s ease;
        }
        .summary-card:hover {
          transform: translateY(-5px);
        }
        .summary-icon {
          font-size: 28px;
          margin-bottom: 10px;
        }

        /* Leave badges */
        .badge-leave {
          padding: 6px 12px;
          border-radius: 12px;
          font-size: 0.9rem;
        }

        /* Tables */
        .table th {
          text-transform: uppercase;
          font-size: 0.85rem;
          letter-spacing: 0.5px;
        }
      </style>

      <div class="container-fluid">
        <div class="row">
          
          <!-- Sidebar -->
          <div class="dashboard-sidebar">
            <div class="list-group" id="sidebarMenu">
              <a href="/dashboard" class="list-group-item list-group-item-action">
                <i class="fa fa-tachometer-alt me-2"></i> Dashboard
              </a>
              <a href="/dashboard/attendance" class="list-group-item list-group-item-action">
                <i class="fa fa-calendar-check me-2"></i> Track Attendance
              </a>
              <a href="/dashboard/leave" class="list-group-item list-group-item-action active">
                <i class="fa fa-plane-departure me-2"></i> Leave Management
              </a>
              <a href="/dashboard/loan_financial_aid" class="list-group-item list-group-item-action">
                <i class="fa fa-hand-holding-usd me-2"></i> Loan &amp; Financial Aid
              </a>
              <a href="/dashboard/expenses" class="list-group-item list-group-item-action">
                <i class="fa fa-wallet me-2"></i> Expenses
              </a>
              <a href="/dashboard/about_me" class="list-group-item list-group-item-action">
                <i class="fa fa-user me-2"></i> About Me
              </a>
            </div>
          </div>

          <!-- Main Content -->
          <div class="dashboard-content col">

            <!-- Attendance Section -->
            <div id="attendance-section">
              <h2 class="fw-bold mb-3 text-primary">Attendance Dashboard</h2>
              <h6 class="text-muted mb-4">
                <i class="fa fa-user-circle me-1"></i>
                <t t-esc="data['employee']"/> | Joined: <t t-esc="data['joining_date']"/>
              </h6>

              <!-- Summary cards -->
              <div class="row g-3 mb-3">
                <div class="col-md-3">
                  <div class="summary-card" style="background: linear-gradient(45deg, #198754, #20c997);">
                    <div class="summary-icon"><i class="fa fa-check-circle"></i></div>
                    <h6>Present</h6>
                    <h3><t t-esc="data['present']"/></h3>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="summary-card" style="background: linear-gradient(45deg, #ffc107, #fd7e14);">
                    <div class="summary-icon"><i class="fa fa-clock"></i></div>
                    <h6>Late</h6>
                    <h3><t t-esc="data['late']"/></h3>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="summary-card" style="background: linear-gradient(45deg, #dc3545, #e55353);">
                    <div class="summary-icon"><i class="fa fa-times-circle"></i></div>
                    <h6>Absent</h6>
                    <h3><t t-esc="data['absent']"/></h3>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="summary-card" style="background: linear-gradient(45deg, #0dcaf0, #0d6efd);">
                    <div class="summary-icon"><i class="fa fa-sun"></i></div>
                    <h6>Offday</h6>
                    <h3><t t-esc="data['offday']"/></h3>
                  </div>
                </div>
              </div>

              <!-- Extra Hours -->
              <div class="alert alert-primary text-center rounded-pill shadow-sm">
                <i class="fa fa-hourglass-half me-2"></i>
                <b>Total Extra Hours:</b> 
                <t t-esc="'{:.2f}'.format(data['total_extra_hours'])"/> hrs
              </div>
              
              <!-- Attendance Chart -->
              <div class="card shadow-sm rounded-4 mb-4">
                <div class="card-body">
                  <h5 class="fw-bold mb-3">Attendance Overview</h5>
                  <div style="max-width: 70%; margin: auto;"> <!-- reduce width here -->
                    <canvas id="attendanceChart" height="120"></canvas>
                  </div>
                </div>
              </div>

              <script>
                document.addEventListener("DOMContentLoaded", function () {
                  const ctx = document.getElementById('attendanceChart').getContext('2d');
                  new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                      labels: ['Present', 'Late', 'Absent', 'Offday'],
                      datasets: [{
                        data: [
                          <t t-esc="data['present']"/>,
                          <t t-esc="data['late']"/>,
                          <t t-esc="data['absent']"/>,
                          <t t-esc="data['offday']"/>
                        ],
                        backgroundColor: ['#198754', '#ffc107', '#dc3545', '#0dcaf0'],
                        borderWidth: 1
                      }]
                    },
                    options: {
                      responsive: true,
                      plugins: {
                        legend: { position: 'bottom' }
                      }
                    }
                  });
                });
              </script>

              <!-- Daily Records -->
              <div class="card shadow-sm rounded-4 mt-4">
                <div class="card-body">
                  <h5 class="fw-bold mb-3">Daily Records</h5>
                  <div class="table-responsive">
                    <table class="table table-hover align-middle">
                      <thead class="table-dark">
                        <tr>
                          <th>Date</th>
                          <th>Check In</th>
                          <th>Check Out</th>
                          <th>Hours</th>
                          <th>Extra Hours</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        <t t-foreach="data['days']" t-as="day">
                          <tr>
                            <td><t t-esc="day['date']"/></td>
                            <td><t t-esc="day['check_in']"/></td>
                            <td><t t-esc="day['check_out']"/></td>
                            <td><t t-esc="day['hours']"/> h</td>
                            <td><t t-esc="day['extra_hours']"/> h</td>
                            <td>
                              <span t-if="day['status']=='Present'" class="badge bg-success">Present</span>
                              <span t-if="day['status']=='Late'" class="badge bg-warning text-dark">Late</span>
                              <span t-if="day['status']=='Absent'" class="badge bg-danger">Absent</span>
                              <span t-if="day['status']=='Offday'" class="badge bg-info">Offday</span>
                            </td>
                          </tr>
                        </t>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div> <!-- End content -->
        </div>
      </div>
      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const menuItems = document.querySelectorAll("#sidebarMenu a");
          const currentPath = window.location.pathname;

          menuItems.forEach(item => {
            item.classList.remove("active");
            if (item.getAttribute("href") === currentPath) {
              item.classList.add("active");
            }
          });
        });
      </script>
    </t>
  </template>
</odoo>
